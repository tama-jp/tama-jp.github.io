<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Google画像をスクレイピングしてみよう！！ - Ko-Da-Wa-Ri</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta itemprop=name content="Google画像をスクレイピングしてみよう！！"><meta itemprop=description content="※ 過去に書いた記事を載せています。今動作するかは不明。。。。 すみっコぐらしをめっちゃ好きでLineスタンプはすべてコンプリートしています*."><meta itemprop=datePublished content="2022-07-05T12:07:08+09:00"><meta itemprop=dateModified content="2022-07-05T12:07:08+09:00"><meta itemprop=wordCount content="2241"><meta itemprop=keywords content="ETC,"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-788BH2CZ5H"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-788BH2CZ5H",{anonymize_ip:!1})}</script><script>var _paq=window._paq=window._paq||[];_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["setCookieDomain","*.kodawari.info"]),_paq.push(["setDomains",["*.kodawari.info"]]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//kodawari.club/matomo/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","2"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script><noscript><p><img src="//kodawari.club/matomo/matomo.php?idsite=2&rec=1" style=border:0 alt></p></noscript></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class="logo logo--mixed"><a class=logo__link href=/ title=Ko-Da-Wa-Ri rel=home><div class="logo__item logo__imagebox"><img class=logo__img src=/img/cheer.png></div><div class="logo__item logo__text"><div class=logo__title>Ko-Da-Wa-Ri</div><div class=logo__tagline>たまたんの適当なブログ</div></div></a></div><div class=divider></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Google画像をスクレイピングしてみよう！！</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>tama-tan</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2022-07-05T12:07:08+09:00>2022-07-05</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/etc/ rel=category>ETC</a></span></div></div></header><div class="content post__content clearfix"><p>※ 過去に書いた記事を載せています。今動作するかは不明。。。。</p><p>すみっコぐらしをめっちゃ好きでLineスタンプはすべてコンプリートしています*.⋆( ˘̴͈́ ॢ꒵ॢ ˘̴͈̀ )⋆.*
それは置いといて。。。。 ＼(･<em>＼)ｿﾉﾊﾅｼﾊ (／</em>･)／ｺｯﾁﾆｵｲﾄｲﾃ</p><p>PCに自動的に壁紙にするのも良いよなー、でもわざわざ探すのも面倒だしなーってことで、
画像スクレイピングで、すみっコぐらしを取得しよう！！っと思い紹介。</p><p>さて、はじめに、画像を取るにしても元ネタを探さなければなりません。
こういうときには、Google先生がいるではありませんか！！</p><p>そこから、画像を抜き出していけば、《《《《♪♪(<em>´▽｀</em>)ノ゛うふふ〜</p><p>それじゃ、初めてみましょうか。</p><p>まず、Google画像検索を開いて。</p><pre tabindex=0><code>https://www.google.co.jp/imghp?hl=ja
</code></pre><p>に、キーワード「すみっコぐらし」を入れて見る</p><p>以下のようなアドレスが出て、Bodyには画像がいっぱい。</p><pre tabindex=0><code>https://www.google.co.jp/search?hl=ja&amp;tbm=isch&amp;source=hp&amp;biw=1588&amp;bih=906&amp;ei=k31FW5m7DMW90gTgjIzQCA&amp;q=%E3%81%99%E3%81%BF%E3%81%A3%E3%82%B3%E3%81%90%E3%82%89%E3%81%97&amp;oq=%E3%81%99%E3%81%BF%E3%81%A3%E3%82%B3%E3%81%90%E3%82%89%E3%81%97&amp;gs_l=img.3..0i4k1j0j0i4k1l8.28705.29989.0.30812.5.5.0.0.0.0.172.596.2j3.5.0....0...1ac.1j4.64.img..1.4.510....0.FRb11i-VRo8
</code></pre><p>引数がいっぱいあるけど、必要でなさそうなのは削除してみる。。。。</p><p>以下を、たたいてみても問題なく取得できそう。</p><pre tabindex=0><code>https://www.google.co.jp/search?hl=ja&amp;tbm=isch&amp;q=%E3%81%99%E3%81%BF%E3%81%A3%E3%82%B3%E3%81%90%E3%82%89%E3%81%97
</code></pre><p>ちなみに、これをURLデコードすると</p><pre tabindex=0><code>https://www.google.co.jp/search?tbm=isch&amp;q=すみっコぐらし
</code></pre><p>となる</p><p>これをたたいてHTMLを取得します。
取得できるものをChromeやFireFoxでHTMLの中を見ると以下のようになっていると思います。</p><p><img src=../img/%E3%82%B9%E3%82%AF%E3%83%AC%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0.png alt=スクレイピング.png></p><p>classタグの「rg_meta notranslate」てのがありますね。
たぶんこれがでサイトの細かいデータのようです。</p><p>これを一部取りだして見てみましょう。。。。</p><pre tabindex=0><code>{&#34;id&#34;:&#34;wWMIkItAEKJTEM:&#34;,&#34;isu&#34;:&#34;books.rakuten.co.jp&#34;,&#34;itg&#34;:0,&#34;ity&#34;:&#34;jpg&#34;,&#34;oh&#34;:640,&#34;ou&#34;:&#34;https://shop.r10s.jp/book/cabinet/5768/9784092895768.jpg&#34;,&#34;ow&#34;:435,&#34;pt&#34;:&#34;楽天ブックス: すみっコぐらしストーリーズ - ひみつのすみっコ生活 ...&#34;,&#34;rh&#34;:&#34;books.rakuten.co.jp&#34;,&#34;rid&#34;:&#34;2AQKjtQM7vPpdM&#34;,&#34;rt&#34;:0,&#34;ru&#34;:&#34;https://books.rakuten.co.jp/rb/13222030/&#34;,&#34;s&#34;:&#34;すみっコぐらしストーリーズ[せきちさと]&#34;,&#34;sc&#34;:1,&#34;st&#34;:&#34;楽天ブックス - 楽天市場&#34;,&#34;th&#34;:272,&#34;tu&#34;:&#34;https://encrypted-tbn0.gstatic.com/images?q\u003dtbn:ANd9GcQBWnTHJQlhwZRDvPN4jRhT5KxV6QkCjgPner8OwAmEj0fV7E8t&#34;,&#34;tw&#34;:185}
</code></pre><p>んん？JSONですね。整形してみると。。。。</p><pre tabindex=0><code>{
  &#34;id&#34; : &#34;wWMIkItAEKJTEM:&#34;,
  &#34;isu&#34; : &#34;books.rakuten.co.jp&#34;,
  &#34;itg&#34; : 0,
  &#34;ity&#34; : &#34;jpg&#34;,
  &#34;oh&#34; : 640,
  &#34;ou&#34; : &#34;https://shop.r10s.jp/book/cabinet/5768/9784092895768.jpg&#34;,
  &#34;ow&#34; : 435,
  &#34;pt&#34; : &#34;楽天ブックス: すみっコぐらしストーリーズ - ひみつのすみっコ生活 ...&#34;,
  &#34;rh&#34; : &#34;books.rakuten.co.jp&#34;,
  &#34;rid&#34; : &#34;2AQKjtQM7vPpdM&#34;,
  &#34;rt&#34; : 0,
  &#34;ru&#34; : &#34;https://books.rakuten.co.jp/rb/13222030/&#34;,
  &#34;s&#34; : &#34;すみっコぐらしストーリーズ[せきちさと]&#34;,
  &#34;sc&#34; : 1,
  &#34;st&#34; : &#34;楽天ブックス - 楽天市場&#34;,
  &#34;th&#34; : 272,
  &#34;tu&#34; : &#34;https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQBWnTHJQlhwZRDvPN4jRhT5KxV6QkCjgPner8OwAmEj0fV7E8t&#34;,
  &#34;tw&#34; : 185
}
</code></pre><p>URLが入っているのは、「ou」、「ru」、「tu」かな？</p><p>「tu」は、</p><pre tabindex=0><code>https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQBWnTHJQlhwZRDvPN4jRhT5KxV6QkCjgPner8OwAmEj0fV7E8t
</code></pre><p>googleさんがつくったサムネイル画像みたいですね。</p><p>「ru」は、</p><pre tabindex=0><code>https://books.rakuten.co.jp/rb/13222030/
</code></pre><p>置いている元サイトかな？画像じゃないね。</p><p>「ou」は、</p><pre tabindex=0><code>https://shop.r10s.jp/book/cabinet/5768/9784092895768.jpg
</code></pre><p>たぶんこれが、画像ですね。！！</p><p>これをダウンロードすればいいです。</p><p>それで、手順を簡単に書くと</p><ol><li><a href=https://www.google.co.jp/imghp>google画像検索</a>にキーワードを入れてアクセスする</li><li>取得できたHTMLで、classタグの「rg_meta notranslate」を配列で抜き出す。</li><li>そこから、「ou」というタグを見つけてその中のURLを取得</li><li>画像を保存</li></ol><p>これだけの、かーんたーんなお・し・ご・と！！（⌒^⌒)ｂうふっ</p><p>実際に、Python3でこれを組んでみました。
一度ためしてみてください。
走り書きで書いたのでフォーマットぐちゃぐちゃです。ごめんなさいｍ（＿＿）ｍ</p><pre tabindex=0><code>#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Created on 2018/07/13.

import os
from urllib import request as req
from urllib import error
from urllib import parse
import bs4
# pip3 install bs4
from datetime import datetime

import re

keyword =&#39;すみっコぐらし&#39;
subPath = &#34;./&#34;

print(&#34;--- Start ---&#34;)
print(&#34;--- &#34; + keyword + &#34;画像ダウンロード&#34; + &#34; ---&#34;)
print(datetime.now().strftime(&#34;%Y/%m/%d %H:%M:%S&#34;))

print(&#34;--- ディレクトリ作成 ---&#34;)
keywordPath=subPath + keyword

if not os.path.exists(subPath):
	os.mkdir(subPath)

if not os.path.exists(keywordPath):
	os.mkdir(keywordPath)

print(&#34;--- google画像情報サイト取得 ---&#34;)

urlKeyword = parse.quote(keyword)
url = &#39;https://www.google.co.jp/search?tbm=isch&amp;q=&#39; + urlKeyword + &#39;&#39;

headers = {&#34;User-Agent&#34;: &#34;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:47.0) Gecko/20100101 Firefox/47.0&#34;,}
request = req.Request(url=url, headers=headers)
page = req.urlopen(request)

print(&#34;--- データパース ---&#34;)
html = page.read().decode(&#39;utf-8&#39;)
html = bs4.BeautifulSoup(html, &#34;html.parser&#34;)
elems = html.select(&#39;.rg_meta.notranslate&#39;)

print(&#34;--- 画像取得 ---&#34;)

counter = 0
for ele in elems:
	ele = ele.contents[0].replace(&#39;&#34;&#39;,&#39;&#39;).split(&#39;,&#39;)
	eledict = dict()

	# ou:のついているものが画像本体なのでそれを取り出す
	for e in ele:
		num = e.find(&#39;:&#39;)
		eledict[e[0:num]] = e[num+1:]
	imageURL = eledict[&#39;ou&#39;]
	
	pal = &#39;jpg&#39;
	if &#39;.jpg&#39; in imageURL:
		pal = &#39;.jpg&#39;
	elif &#39;.JPG&#39; in imageURL:
		pal = &#39;.jpg&#39;
	elif &#39;.png&#39; in imageURL:
		pal = &#39;.png&#39;
	elif &#39;.gif&#39; in imageURL:
		pal = &#39;.gif&#39;
	elif &#39;.jpeg&#39; in imageURL:
		pal = &#39;.jpeg&#39;
	else:
		pal = &#39;.jpg&#39;

	counter += 1
	fileName=keywordPath+ &#39;/&#39; + keyword + str(counter)+pal

	try:
		# 画像取得
		img = req.urlopen(imageURL)
		localfile = open(fileName, &#39;wb&#39;)
		localfile.write(img.read())
		img.close()
		localfile.close()
	except :
		#エラーの場合は次のデータを取得
		continue
		
print(datetime.now().strftime(&#34;%Y/%m/%d %H:%M:%S&#34;))
print(&#34;--- End ---&#34;)
</code></pre><p>今回は短いですけどこんなんでw</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/etc/ rel=tag>ETC</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="tama-tan avatar" src=/img/avatar.png class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>About tama-tan</span></div><div class=authorbox__description>いろいろプログラミングをやっています。今は、go言語にはまってます。</div></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/posts/mac%E3%81%AE%E8%A8%AD%E5%AE%9A%E8%B6%85%E9%81%A9%E5%BD%93/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>Macの設定（超適当）</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/posts/api%E3%81%AE%E6%AD%BB%E6%B4%BB%E7%9B%A3%E8%A6%96%E3%82%92rocketchat%E3%81%AB%E9%80%81%E4%BF%A1%E3%81%99%E3%82%8B/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>APIの死活監視をRocketChatに送信する</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2022 Ko-Da-Wa-Ri.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>